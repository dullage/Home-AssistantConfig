# Run the goodnight script once the front room and kitchen doors have been closed for a bit.
- alias: auto_goodnight
  initial_state: true
  mode: restart
  trigger:
    platform: state
    entity_id: group.downstairs_internal_doors
    to: "off"
    for:
      seconds: 3
  condition:
    condition: time
    after: "20:00:00"
  action:
    - service: automation.turn_off
      entity_id: automation.kitchen_motion_leds_up
    - service: automation.turn_off
      entity_id: automation.kitchen_motion_leds_down

    - service: input_boolean.turn_off
      entity_id: input_boolean.all_av
    - service: rest_command.override_stair_light_live
    - service: scene.turn_on
      entity_id: scene.downstairs_timeout
    - delay:
        minutes: 3

    - service: automation.turn_on
      entity_id: automation.kitchen_motion_leds_up
    - service: automation.turn_on
      entity_id: automation.kitchen_motion_leds_down

    - condition: state
      entity_id: group.downstairs_internal_doors
      state: "off"

    - service: script.goodnight

# After 9pm, once the downstairs lights have all been off for 5 minutes, run the goodnight script.
- alias: bedtime
  initial_state: true
  trigger:
    platform: state
    entity_id: group.downstairs
    to: "off"
    for:
      minutes: 5
  condition:
    condition: time
    after: "21:00:00"
  action:
    - service: script.goodnight
