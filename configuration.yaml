####################
## Home Assistant ##
####################

homeassistant:
  name: Home
  external_url: !secret external_url
  internal_url: !secret internal_url
  latitude: !secret latitude
  longitude: !secret longitude
  elevation: !secret elevation
  unit_system: metric
  time_zone: Europe/London
  customize_domain:
    switch:
      assumed_state: false
  allowlist_external_dirs:
    - "/config/bird_blaster_recordings"
    - "/media/cctv"

zone: !secret zones

# Web
cloud:
  google_actions: !include config/voice_assistants/google.yaml

http:
  ip_ban_enabled: true
  login_attempts_threshold: 5
  server_port: 8448
  trusted_proxies:
    - 172.16.0.0/12
  use_x_forwarded_for: true

# Core
logger:
  default: warn

recorder:
  db_url: !secret db_url

logbook:
  exclude:
    domains:
      - group
      - media_player
      - automation
    entities:
      - light.downstairs
    entity_globs:
      - sensor.dark_sky*

lovelace:
  mode: yaml

person:
  - name: Adam
    id: adam
    device_trackers:
      # iOS App
      - device_tracker.dullage_s_iphone
  - name: Leanne
    id: leanne
    device_trackers:
      # iOS App
      - device_tracker.iphone

config:
frontend:
history:
map:
mobile_app:
sun:
system_health:
updater:
shopping_list:
ffmpeg:
stream:

# Include
automation: !include_dir_merge_list config/automations/
script: !include_dir_merge_named config/scripts/
light: !include_dir_merge_list config/lights/
switch: !include_dir_merge_list config/switches/
scene: !include_dir_merge_list config/scenes/
group: !include config/groups.yaml
shell_command: !include_dir_merge_named config/shell_commands/
binary_sensor: !include_dir_merge_list config/binary_sensors/
sensor: !include_dir_merge_list config/sensors/
input_boolean: !include config/inputs/input_boolean.yaml
input_number: !include config/inputs/input_number.yaml
input_select: !include config/inputs/input_select.yaml
input_datetime: !include config/inputs/input_datetime.yaml

####################
##  Integrations  ##
####################

# iOS
ios:
  push:
    categories:
      - name: Weekend Heating Warning
        identifier: "location_heating_warning"
        actions:
          - identifier: "HEATING_TURN_OFF"
            title: "Turn Heating Off"
            activationMode: "background"
            authenticationRequired: no
            destructive: no
            # behavior: 'textInput'
            # textInputButtonTitle: 'Silencio!'
            # textInputPlaceholder: 'Placeholder'
      - name: Overtime Log
        identifier: "overtime_log"
        actions:
          - identifier: "LOG_ONE_HOUR"
            title: "Log 1hr Overtime"
            activationMode: "background"
            authenticationRequired: no
            destructive: no
      - name: Clear Shopping List
        identifier: "clear_shopping_list"
        actions:
          - identifier: "CLEAR_SHOPPING_LIST"
            title: "Clear Shopping List"
            activationMode: "background"
            authenticationRequired: no
            destructive: yes
      - name: Alarm
        identifier: "alarm"
        actions:
          - identifier: "DISARM_ALARM"
            title: "Disarm"
            activationMode: "background"
            authenticationRequired: no
            destructive: yes
      - name: Activate Sprinklers
        identifier: "activate_sprinklers"
        actions:
          - identifier: "ACTIVATE_SPRINKLERS"
            title: "Activate Sprinklers"
            activationMode: "background"
            authenticationRequired: no
      - name: Cancel Sprinklers
        identifier: "cancel_sprinklers"
        actions:
          - identifier: "CANCEL_SPRINKLERS"
            title: "Cancel Sprinklers"
            activationMode: "background"
            authenticationRequired: no
            destructive: yes

# HomeKit
homekit: !include config/voice_assistants/siri.yaml

# Text to Speech
tts:
  - platform: amazon_polly
    aws_access_key_id: !secret aws_access_key_id
    aws_secret_access_key: !secret aws_secret_access_key
    region_name: "eu-west-1"
    text_type: ssml
    voice: Amy

# MQTT
mqtt:
  discovery: true
  broker: 127.0.0.1
  username: !secret mqtt_username
  password: !secret mqtt_password

# IFTTT
ifttt:
  key: !secret ifttt_key

# Nest
nest:
  project_id: !secret google_sdm_project_id
  client_id: !secret google_sdm_client_id
  client_secret: !secret google_sdm_client_secret
  subscriber_id: !secret google_sdm_subscriber_id

# Office Heater Thermostat
climate:
  - platform: generic_thermostat
    name: Office Heater
    heater: switch.office_heater
    target_sensor: sensor.office_temperature_sensor_temperature

# Rest Commands
rest_command:
  override_stair_light_live:
    url: "http://192.168.0.156/win&LO=1"

# Cameras
camera:
  - platform: mjpeg
    name: Kitchen
    mjpeg_url: http://192.168.0.108:8081
    still_image_url: http://192.168.0.108/picture/1/current/

# Alarm
alarm_control_panel:
  - platform: manual
    delay_time: 0
    arming_time: 0
    disarmed:
      trigger_time: 0

# Used for the CCTV notifications
media_source:
folder_watcher:
  - folder: /media/cctv

# Notification Groups
notify:
  - name: iphones
    platform: group
    services:
      - service: mobile_app_dullage_s_iphone
      - service: mobile_app_iphone
